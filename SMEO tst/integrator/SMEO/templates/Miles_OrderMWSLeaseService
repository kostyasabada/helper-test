<#setting time_zone="Europe/Amsterdam">
<#assign aDateTime = .now>

<#assign businessPartnerId = body.businessPartnerId />
<#if headers.restConnectorProperties.environment == "MC">
    <#assign businessPartnerId = "976313" />
</#if>

<#macro checkNode key value>
    <#switch key>
        <#case "requestedDeliveryDate"><#t>${aDateTime?string["yyyy-MM-dd"]}<#break>
        <#case "requestedDeliveryDestination"><#t>${body.deliveryRegion},${body.deliveryCity}<#break>
         <#default>
            <#if value?is_hash>
                <#t><@printObjectToJson source=value /><#break>
            <#else>
                <#t>${value}<#break>
            </#if>
    </#switch>
</#macro>

<?xml version="1.0" encoding="UTF-8" ?>
<SofEnvelope>
    <sessionID>${body.MILES_sessionID}</sessionID>
    <webrole>fleetmanager</webrole>
    <drivercontactid>${body.contactId}</drivercontactid>
    <customerpartnerid>${businessPartnerId}</customerpartnerid>
    <formalapproval>true</formalapproval>
    <data>
        <@JSONToXML node=body.data shallow=true check=true/>
        <MWSLeaseService>
            <@JSONToXML node=body.data.MWSLeaseService shallow=true check=true/>
            <#if body.data.MWSLeaseService.MWSComponent_Set?has_content>
                <MWSComponent_Set>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSComponent_Set/>
                </MWSComponent_Set>
            </#if>
            <#if body.data.MWSLeaseService.MWSDriver?has_content>
                <MWSDriver>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSDriver/>
                </MWSDriver>
            </#if>
            <#if body.data.MWSLeaseService.MWSCustomer?has_content>
                <MWSCustomer>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSCustomer/>
                </MWSCustomer>
            </#if>
            <#if body.data.MWSLeaseService.MWSVehicle?has_content>
                <MWSVehicle>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSVehicle check=true />
                </MWSVehicle>
            </#if>
            <#if body.data.MWSLeaseService.CalculationErrors?has_content>
                <CalculationErrors>
                    <@JSONToXML node=body.data.MWSLeaseService.CalculationErrors />
                </CalculationErrors>
            </#if>
            <#if body.data.MWSLeaseService.MWSProductConfiguration?has_content>
                <MWSProductConfiguration>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSProductConfiguration />
                </MWSProductConfiguration>
            </#if>
            <#if body.data.MWSLeaseService.MWSCoCustomer_Set?has_content>
                <MWSCoCustomer_Set>
                    <@JSONToXML node=body.data.MWSLeaseService.MWSCoCustomer_Set />
                </MWSCoCustomer_Set>
            </#if>
            <#if body.data.MWSLeaseService.Extended?has_content>
                <Extended>
                    <@JSONToXML node=body.data.MWSLeaseService.Extended />
                </Extended>
            </#if>
        </MWSLeaseService>
    </data>
    <metadata>         
    <operationstatus businesserror="false" technicalerror="false" calculationerror="false"/>
    </metadata> 
</SofEnvelope> 