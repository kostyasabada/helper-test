<#assign aDateTime = .now>
<#assign contactId = body.answers.contract_id.data.answer[0]?number/>

{
    "taskId": "${body.answers.taskid.data.answer[0]}",
    "processInstanceId": "${body.answers.processinstanceid.data.answer[0]}",
    "processVariables": {
        "contactCreated": {
            "value": "${body.answers.contract_created.data.answer[0]}",
            "type": "String"
        },
        "stockVehicleAssignedToCustomer": {
            "value": "${body.answers.stock_vehicle_assigned_to_customer.data.answer[0]}",
            "type": "String"
        }
        <#if body.answers.contract_created.data.answer[0] == "no" ||
             body.answers.stock_vehicle_assigned_to_customer.data.answer[0] == "no"
        >
        ,"isAllowed": {
            "value": "false",
            "type": "String"
        }
        <#else>
        ,"isAllowed": {
            "value": "true",
            "type": "String"
        }
        </#if>
        <#if body.answers.contract_id?? && body.answers.contract_id?has_content>
        ,"contractId": {
            "type": "String",
            "value": "${body.answers.contract_id.data.answer[0]}"
        }
        </#if>
    },
    "saveToDB": [
        {
            "variableName": "manualChangesInMilesArgumentation",
            "type": "TEXT",
            "value": "${body.answers.argumentation.data.answer[0]}"
        },
        {
            "variableName": "contactCreated",
            "type": "STRING",
            "value": "${body.answers.contract_created.data.answer[0]}"
        },
        <#if body.answers.contract_id?? && body.answers.contract_id?has_content>
        {
            "variableName": "contractId",
            "type": "STRING",
            "value": "${body.answers.contract_id.data.answer[0]}"
        },
        </#if>
        {
            "variableName": "stockVehicleAssignedToCustomer",
            "type": "STRING",
            "value": "${body.answers.stock_vehicle_assigned_to_customer.data.answer[0]}"
        },
        {
            "variableName": "note_${aDateTime?long?c}",
            "type": "TEXT",
            "value": "{\"text\":\"${body.answers.argumentation.data.answer[0]?json_string}\",\"formName\":\"Manual changes in Miles\",\"author\":\"${body.secureData.user.profile.firstName} ${body.secureData.user.profile.lastName}\",\"datetime\":\"${aDateTime?iso_utc}\"}"
        }
    ]
}