<#assign businessPartnerId = body.businessPartnerId/>

<#if body.data.MWSBankAccount_Set?? && body.data.MWSBankAccount_Set?is_hash >
<#if headers.restConnectorProperties.environment != "DHC">
    <#assign businessPartnerId = "976313"/>
</#if>

    <?xml version="1.0" encoding="UTF-8"?>
    <SofEnvelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <sessionID>${body.MILES_sessionID}</sessionID>
        <businesspartnerid>${businessPartnerId}</businesspartnerid>
        <data>
            <@JSONToXML node=body.data />
        </data>
        <metadata>
                <@JSONToXML node=body.metadata />
        </metadata>
    </SofEnvelope>
    
<#else>
<#if headers.restConnectorProperties.environment != "DHC">
    <#assign businessPartnerId = "747007"/>
</#if>

    <?xml version="1.0" encoding="UTF-8"?>
    <SofEnvelope>
        <sessionID>${body.MILES_sessionID}</sessionID>
        <businesspartnerid>${businessPartnerId}</businesspartnerid>
          <data>
            <MWSBankAccount_Set>
              <MWSBankAccount>
                <accountNumber>${body.IBAN}</accountNumber>
                <bankAccountState id="720" type="132" group="1067">Open</bankAccountState>
                <bankAccountType id="726" type="143">External BankAccount</bankAccountType>
                <bankCode>${body.BIC}</bankCode>
                <checkType id="1726" type="290" group="1865">IBAN</checkType>
              </MWSBankAccount>
            </MWSBankAccount_Set>
          </data>
          <metadata>
            <operationstatus businesserror="true" technicalerror="true" calculationerror="true" />
          </metadata>
    </SofEnvelope>

</#if>
